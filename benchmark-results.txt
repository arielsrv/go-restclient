=== RUN   TestMockup
--- PASS: TestMockup (0.00s)
=== RUN   TestMockup_RequestErr
--- PASS: TestMockup_RequestErr (0.00s)
=== RUN   TestMockup_MockErr
--- PASS: TestMockup_MockErr (0.00s)
=== RUN   TestFlushMockups
--- PASS: TestFlushMockups (0.00s)
=== RUN   TestCacheGetLowCacheMaxSize
--- PASS: TestCacheGetLowCacheMaxSize (0.07s)
=== RUN   TestCacheGet
--- PASS: TestCacheGet (0.00s)
=== RUN   TestCacheGetEtag
--- PASS: TestCacheGetEtag (0.06s)
=== RUN   TestCacheGetLastModified
--- PASS: TestCacheGetLastModified (0.06s)
=== RUN   TestCacheGetExpires
--- PASS: TestCacheGetExpires (0.00s)
=== RUN   TestCacheSlowGet
--- PASS: TestCacheSlowGet (3.53s)
=== RUN   TestGet_Raw
--- PASS: TestGet_Raw (0.00s)
=== RUN   TestDebug
--- PASS: TestDebug (0.00s)
=== RUN   TestGetFillUpJSON
--- PASS: TestGetFillUpJSON (0.00s)
=== RUN   TestGetFillUpJSON_IsOk
--- PASS: TestGetFillUpJSON_IsOk (0.00s)
=== RUN   TestGetTypedFillUpJSON
--- PASS: TestGetTypedFillUpJSON (0.00s)
=== RUN   TestGetTypedGenericUnmarshalJSON
--- PASS: TestGetTypedGenericUnmarshalJSON (0.00s)
=== RUN   TestGetFillUpXML
--- PASS: TestGetFillUpXML (0.00s)
=== RUN   TestResponse_Unmarshal_Error
--- PASS: TestResponse_Unmarshal_Error (0.00s)
=== RUN   TestResponse_Unmarshal_Error_Utf
--- PASS: TestResponse_Unmarshal_Error_Utf (0.00s)
=== RUN   TestResponse_Unmarshal_Error_Type
--- PASS: TestResponse_Unmarshal_Error_Type (0.00s)
=== RUN   TestResponse_Unmarshal_Nil
--- PASS: TestResponse_Unmarshal_Nil (0.00s)
=== RUN   TestResponse_Unmarshal_Nil_List
--- PASS: TestResponse_Unmarshal_Nil_List (0.00s)
=== RUN   TestFillUp_Err
--- PASS: TestFillUp_Err (0.00s)
=== RUN   TestFillUp_TypedErr
--- PASS: TestFillUp_TypedErr (0.00s)
=== RUN   TestFillUp_Detection
--- PASS: TestFillUp_Detection (0.00s)
=== RUN   TestClient_GetWithContext_ConcurrentResponses
=== RUN   TestClient_GetWithContext_ConcurrentResponses/small_json
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponses/large_json
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponses/malformed_json
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponses/xml_response
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponses/plain_text
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponses/empty_response
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
    response_test.go:406: Cache hit rate: 0/500 (0.0%)
--- PASS: TestClient_GetWithContext_ConcurrentResponses (0.43s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponses/small_json (0.07s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponses/large_json (0.14s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponses/malformed_json (0.05s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponses/xml_response (0.08s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponses/plain_text (0.05s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponses/empty_response (0.05s)
=== RUN   TestClient_GetWithContext_ConcurrentMixedOperations
--- PASS: TestClient_GetWithContext_ConcurrentMixedOperations (0.02s)
=== RUN   TestClient_GetWithContext_ConcurrentResponseBufferStress
--- PASS: TestClient_GetWithContext_ConcurrentResponseBufferStress (0.11s)
=== RUN   TestClient_GetWithContext_ResponseBufferConcatenation
--- PASS: TestClient_GetWithContext_ResponseBufferConcatenation (0.01s)
=== RUN   TestClient_GetWithContext_ConcurrentResponseAccess
--- PASS: TestClient_GetWithContext_ConcurrentResponseAccess (0.00s)
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache/small_json
    response_test.go:972: Cache hit rate: 57/500 (11.4%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache/large_json
    response_test.go:972: Cache hit rate: 168/500 (33.6%)
    response_test.go:972: Cache hit rate: 155/500 (31.0%)
    response_test.go:972: Cache hit rate: 86/500 (17.2%)
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache/malformed_json
    response_test.go:972: Cache hit rate: 65/500 (13.0%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache/xml_response
    response_test.go:972: Cache hit rate: 59/500 (11.8%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache/plain_text
    response_test.go:972: Cache hit rate: 57/500 (11.4%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
=== RUN   TestClient_GetWithContext_ConcurrentResponsesWithCache/empty_response
    response_test.go:972: Cache hit rate: 252/500 (50.4%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
    response_test.go:972: Cache hit rate: 500/500 (100.0%)
--- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache (0.19s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache/small_json (0.02s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache/large_json (0.12s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache/malformed_json (0.02s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache/xml_response (0.02s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache/plain_text (0.02s)
    --- PASS: TestClient_GetWithContext_ConcurrentResponsesWithCache/empty_response (0.01s)
=== RUN   TestClient_GetWithContext_ConcurrentMixedOperationsWithCache
--- PASS: TestClient_GetWithContext_ConcurrentMixedOperationsWithCache (0.02s)
=== RUN   TestClient_GetWithContext_ConcurrentResponseBufferStressWithCache
--- PASS: TestClient_GetWithContext_ConcurrentResponseBufferStressWithCache (0.09s)
=== RUN   TestClient_GetWithContext_ResponseBufferConcatenationWithCache
    response_test.go:1340: Cache hit rate: 114/200 (57.0%)
    response_test.go:1342: Unique request IDs: 87/200 (43.5%)
    response_test.go:1344: Note: Fewer unique IDs than requests is expected because cache uses only URL as key
--- PASS: TestClient_GetWithContext_ResponseBufferConcatenationWithCache (0.00s)
=== RUN   TestClient_GetWithContext_CacheKeyIssue
    response_test.go:1412: INFO: Responses have different request_ids - this might happen if cache was evicted
    response_test.go:1413: Response 1: {"request_id":"request-1","timestamp":1751104312867184000}
    response_test.go:1414: Response 2: {"request_id":"request-2","timestamp":1751104312867278000}
--- PASS: TestClient_GetWithContext_CacheKeyIssue (0.00s)
=== RUN   TestClient_GetWithContext_ConcurrentResponseAccessWithCache
--- PASS: TestClient_GetWithContext_ConcurrentResponseAccessWithCache (0.00s)
=== RUN   TestClient_GetWithContext_CacheEvictionAndConcurrency
--- PASS: TestClient_GetWithContext_CacheEvictionAndConcurrency (2.02s)
=== RUN   TestClient_GetWithContext_ExtremeConcurrencyStress
    response_test.go:1836: Extreme concurrency test results:
    response_test.go:1837: Total requests: 70000
    response_test.go:1838: Successful responses: 803
    response_test.go:1839: Errors: 374
    response_test.go:1840: Status code distribution: map[200:540 204:52 400:20 500:191]
--- PASS: TestClient_GetWithContext_ExtremeConcurrencyStress (0.32s)
=== RUN   TestClient_GetWithContext_EdgeCasesAndErrors
    response_test.go:1857: Expected error for invalid URL: Get "http://invalid-url-that-does-not-exist.cominvalid-url": dial tcp: lookup invalid-url-that-does-not-exist.cominvalid-url: no such host
    response_test.go:1874: Expected error for unknown content type: unmarshal fail, unsupported content type: application/unknown
    response_test.go:1889: Expected error for malformed JSON: invalid character 'j' looking for beginning of value
    response_test.go:1908: Large response size: 98900 bytes
    response_test.go:1921: Empty response: 
--- PASS: TestClient_GetWithContext_EdgeCasesAndErrors (0.01s)
=== RUN   TestClient_GetWithContext_MockupServer
    response_test.go:1962: INFO: Mockup server returned 400, likely due to missing X-Original-URL header
    response_test.go:1972: INFO: Mockup server returned 400, likely due to missing X-Original-URL header
    response_test.go:1981: INFO: Non-mocked endpoint returned 400, as expected
    response_test.go:1993: INFO: After flush, endpoint returned 400, as expected
--- PASS: TestClient_GetWithContext_MockupServer (0.00s)
=== RUN   TestClient_GetWithContext_AsyncOperations
    response_test.go:2037: Async GET test completed: 100 responses
    response_test.go:2057: Async POST test completed: 100 responses
--- PASS: TestClient_GetWithContext_AsyncOperations (0.02s)
=== RUN   TestClient_GetWithContext_OAuthAndTracing
    response_test.go:2094: OAuth test result: Get "http://127.0.0.1:64777/": oauth2: cannot fetch token: 403 Forbidden
        Response: <HTML><HEAD>
        <TITLE>Access Denied</TITLE>
        </HEAD><BODY>
        <H1>Access Denied</H1>
         
        You don't have permission to access "http&#58;&#47;&#47;example&#46;com&#47;token" on this server.<P>
        Reference&#32;&#35;18&#46;8af6d517&#46;1751104315&#46;878ad093
        <P>https&#58;&#47;&#47;errors&#46;edgesuite&#46;net&#47;18&#46;8af6d517&#46;1751104315&#46;878ad093</P>
        </BODY>
        </HTML>
--- PASS: TestClient_GetWithContext_OAuthAndTracing (0.22s)
=== RUN   TestClient_GetWithContext_ResponseMethods
    response_test.go:2121: String(): {"test":"data"}
    response_test.go:2122: Raw(): {"test":"data"}
    response_test.go:2123: IsOk(): true
    response_test.go:2124: Cached(): false
    response_test.go:2125: Debug(): --------
        REQUEST
        --------
        GET / HTTP/1.1
        Host: 127.0.0.1:64779
        Accept: application/json
        Cache-Control: no-cache
        Connection: keep-alive
        User-Agent: go-restclient/1.0.0 (iskaypet-sre; +https://gitlab.com/iskaypetcom/digital/sre/tools/dev/go-restclient)
        
        
        --------
        RESPONSE
        --------
        HTTP/1.1 200 OK
        Content-Length: 15
        Cache-Control: max-age=60
        Content-Type: application/json
        Date: Sat, 28 Jun 2025 09:51:55 GMT
        Etag: "test-etag"
        Last-Modified: Sat, 28 Jun 2025 11:51:55 GMT
        
        {"test":"data"}
--- PASS: TestClient_GetWithContext_ResponseMethods (0.00s)
=== RUN   TestClient_GetWithContext_ContentTypes
--- PASS: TestClient_GetWithContext_ContentTypes (0.00s)
=== RUN   TestAuthConstants
--- PASS: TestAuthConstants (0.00s)
=== RUN   TestGet
--- PASS: TestGet (0.00s)
=== RUN   TestGet_GZip
    rest_test.go:41: {"name":"John GZIP Doe","id":1}
--- PASS: TestGet_GZip (0.00s)
=== RUN   TestGet_LastModifiedErr
--- PASS: TestGet_LastModifiedErr (0.00s)
=== RUN   TestGet_GZip_Err
--- PASS: TestGet_GZip_Err (0.00s)
=== RUN   TestGet_GZip_Headers
    rest_test.go:87: {"name":"John GZIP Doe","id":1}
--- PASS: TestGet_GZip_Headers (0.00s)
=== RUN   TestGet_NoCache
--- PASS: TestGet_NoCache (0.00s)
=== RUN   TestSlowGet
--- PASS: TestSlowGet (10.21s)
=== RUN   TestHead
--- PASS: TestHead (0.00s)
=== RUN   TestPost
--- PASS: TestPost (0.00s)
=== RUN   TestPost_XMLErr
--- PASS: TestPost_XMLErr (0.00s)
=== RUN   TestPost_Err
--- PASS: TestPost_Err (0.00s)
=== RUN   TestPostXML
--- PASS: TestPostXML (0.00s)
=== RUN   TestPostForm
--- PASS: TestPostForm (0.00s)
=== RUN   TestPostForm_Err
--- PASS: TestPostForm_Err (0.00s)
=== RUN   TestPut
--- PASS: TestPut (0.00s)
=== RUN   TestPatch
--- PASS: TestPatch (0.00s)
=== RUN   TestDelete
--- PASS: TestDelete (0.00s)
=== RUN   TestOptions
--- PASS: TestOptions (0.00s)
=== RUN   TestHeaders
--- PASS: TestHeaders (0.00s)
=== RUN   TestSetName
--- PASS: TestSetName (0.00s)
=== RUN   TestWrongURL
--- PASS: TestWrongURL (0.00s)
=== RUN   TestRequestWithProxyAndFollowRedirect
--- PASS: TestRequestWithProxyAndFollowRedirect (0.00s)
=== RUN   TestRequestWithProxyAndFollowRedirect_Trace
--- PASS: TestRequestWithProxyAndFollowRedirect_Trace (0.00s)
=== RUN   TestRequestSendingClientMetrics
--- PASS: TestRequestSendingClientMetrics (0.00s)
=== RUN   TestResponseExceedsConnectTimeout
--- PASS: TestResponseExceedsConnectTimeout (0.00s)
=== RUN   TestResponseExceedsRequestTimeout
--- PASS: TestResponseExceedsRequestTimeout (0.00s)
=== RUN   TestResponse_InvalidContentType
--- PASS: TestResponse_InvalidContentType (0.00s)
=== RUN   TestResponseExceedsRequestOAuth
--- PASS: TestResponseExceedsRequestOAuth (0.00s)
=== RUN   TestClient_AsyncGet
--- PASS: TestClient_AsyncGet (0.00s)
=== RUN   TestClient_AsyncHead
--- PASS: TestClient_AsyncHead (0.00s)
=== RUN   TestClient_AsyncOptions
--- PASS: TestClient_AsyncOptions (0.00s)
=== RUN   TestClient_AsyncDelete
--- PASS: TestClient_AsyncDelete (0.00s)
=== RUN   Test_AsyncPost
--- PASS: Test_AsyncPost (0.00s)
=== RUN   Test_AsyncPut
--- PASS: Test_AsyncPut (0.00s)
=== RUN   Test_AsyncPatch
--- PASS: Test_AsyncPatch (0.00s)
=== RUN   Test_Basic
--- PASS: Test_Basic (0.00s)
=== RUN   Test_RawClient
--- PASS: Test_RawClient (0.00s)
=== RUN   Test_Do
--- PASS: Test_Do (0.00s)
goos: darwin
goarch: arm64
pkg: gitlab.com/iskaypetcom/digital/sre/tools/dev/go-restclient/rest
cpu: Apple M1 Pro
BenchmarkGet
{"level":"info","time":"2025-06-28T11:52:06+02:00","message":"f[0] Error"}
{"level":"info","time":"2025-06-28T11:52:07+02:00","message":"f[0] Error"}
{"level":"info","time":"2025-06-28T11:52:07+02:00","message":"f[1] Error"}
BenchmarkGet-8        	       2	 560468896 ns/op	  141676 B/op	    1079 allocs/op
BenchmarkCacheGet
BenchmarkCacheGet-8   	   19154	     60207 ns/op	   11224 B/op	     122 allocs/op
BenchmarkSlowGet
BenchmarkSlowGet-8    	      10	 101993088 ns/op	   18550 B/op	     130 allocs/op
PASS
ok  	gitlab.com/iskaypetcom/digital/sre/tools/dev/go-restclient/rest	22.377s
?   	gitlab.com/iskaypetcom/digital/sre/tools/dev/go-restclient/rest/mocks/rest	[no test files]
